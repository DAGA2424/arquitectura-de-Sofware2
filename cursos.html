<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portafolio — Cursos</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#000; color:#f1f5f9; }
header { position: sticky; top: 0; background: linear-gradient(90deg, #0f172a, #1f2937); color: white; padding: 12px 18px; display: flex; align-items: center; justify-content: space-between; gap: 12px; z-index: 999; box-shadow: 0 2px 8px rgba(0,0,0,0.25); }
.brand { display:flex; gap:12px; align-items:center; }
.brand img { width:48px; height:48px; border-radius:50%; object-fit:cover; }
.brand .title { font-weight:700; font-size:18px; }
.brand .subtitle { font-size:13px; color:#cbd5e1; }
nav a { color:white; text-decoration:none; margin-left:15px; font-weight:500; }
nav a:hover { text-decoration:underline; }
.controls { display:flex; gap:12px; align-items:center; }
select { background:#111827; color:#fff; padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.2); }
button { background:#111827; color:#fff; padding:8px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); cursor:pointer; transition: all 0.2s ease; }
button:hover { opacity: 0.9; }
button.primary { background:#06b6d4; color:#042027; border:none; font-weight:600; }
.hidden { display:none !important; }
main { max-width:1100px; margin:22px auto; padding:0 16px; }
.panel { background:#1e293b; padding:16px; border-radius:10px; border:1px solid #334155; margin-bottom:20px; color:#f1f5f9; }
h3 { margin-bottom:10px; }
h4 { margin:14px 0 10px; color:#38bdf8; }
.files-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:16px; }
.file-item { border:1px solid #475569; border-radius:10px; background:#0f172a; color:#e2e8f0; padding:10px; display:flex; flex-direction:column; justify-content:space-between; position:relative; overflow:hidden; }
.file-preview { background:#1e293b; border-radius:8px; margin-bottom:8px; display:flex; align-items:center; justify-content:center; overflow:hidden; height:140px; }
.file-preview img { max-width:100%; max-height:100%; object-fit:contain; }
.file-preview iframe { width:100%; height:100%; border:none; }
.file-name { font-size:14px; margin-bottom:8px; text-align:center; word-wrap:break-word; }
.file-actions { display:flex; justify-content:center; flex-wrap:wrap; gap:6px; position:relative; z-index:5; }
.btn-view { background:#3b82f6; color:white; padding:6px 12px; border-radius:8px; text-decoration:none; font-size:13px; }
.btn-download { background:#10b981; color:white; padding:6px 12px; border-radius:8px; text-decoration:none; font-size:13px; }
.btn-delete { background:#ef4444; color:white; border:none; padding:6px 12px; border-radius:8px; font-size:13px; cursor:pointer; }
.overlay { position:absolute; inset:0; background:rgba(0,0,0,0.7); color:white; display:flex; align-items:center; justify-content:center; opacity:0; transition:0.3s; font-size:14px; font-weight:600; text-align:center; pointer-events:none; z-index:1; }
.file-item:hover .overlay { opacity:1; }
#vistaPanel { background:#0f172a; border:1px solid #475569; border-radius:10px; padding:16px; min-height:500px; width:100%; display:none; align-items:center; justify-content:center; position:relative; }
#vistaPanel iframe, #vistaPanel img { width:100%; height:800px; border:none; border-radius:8px; }
#closeVista { position:absolute; top:10px; right:10px; background:#ef4444; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; z-index:20; }
</style>
</head>
<body>
<header>
  <div class="brand">
    <img src="UPLA.jpg" alt="Logo">
    <div>
      <div class="title">CARLOS DANIEL GUERRA YARUPAITA</div>
      <div class="subtitle">Portafolio Cursos</div>
    </div>
  </div>
  <nav>
    <a href="index.html">Inicio</a>
    <a href="cursos.html">Cursos</a>
    <a href="contacto.html">Contacto</a>
    <a href="mensajes.html">Mensajes</a>
  </nav>
  <div class="controls">
    <select id="cursoSelect">
      <option value="Arquitectura de Datos" selected>Arquitectura de Datos</option>
      <option value="Inglés IV">Inglés IV</option>
      <option value="Gobierno de TI">Gobierno de TI</option>
      <option value="Machine Learning">Machine Learning</option>
    </select>
    <div id="userGreeting" class="small">Bienvenido, invitado</div>
    <button id="loginBtn">Login</button>
  </div>
</header>
<main>
  <div id="uploadPanel" class="panel hidden">
    <h3>Subir archivos</h3>
    <label for="cursoUpload">Selecciona curso:</label>
    <select id="cursoUpload"></select><br><br>
    <label for="semana">Selecciona semana:</label>
    <select id="semana"></select><br><br>
    <input type="file" id="fileUpload" accept=".pdf,.png,.jpg,.jpeg,.gif,.webp"><br><br>
    <button id="guardarBtn">Guardar</button>
  </div>

  <div id="vistaPanel" class="panel">
    <button id="closeVista" onclick="cerrarVista()">✖ Cerrar</button>
  </div>

  <div id="filesPanel" class="panel">
    <h3>Mis Documentos</h3>
    <div id="docsContainer"></div>
    <br>
    <button onclick="logout()" id="logoutBtn" class="hidden">Cerrar Sesión</button>
  </div>
</main>

<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.6);align-items:center;justify-content:center;z-index:1200;">
  <div style="background:white;padding:18px;border-radius:10px;width:320px;box-shadow:0 8px 30px rgba(2,6,23,0.4);">
    <h3>Iniciar sesión</h3>
    <input id="username" type="text" placeholder="Usuario" style="width:100%;margin-bottom:10px;padding:8px;border:1px solid #cbd5e1;border-radius:8px;" />
    <input id="password" type="password" placeholder="Contraseña" style="width:100%;margin-bottom:10px;padding:8px;border:1px solid #cbd5e1;border-radius:8px;" />
    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button id="closeModal">Cancelar</button>
      <button id="doLogin" class="primary">Entrar</button>
    </div>
  </div>
</div>

<script>
const loginBtn=document.getElementById("loginBtn");
const modal=document.getElementById("modal");
const closeModal=document.getElementById("closeModal");
const doLogin=document.getElementById("doLogin");
const uploadPanel=document.getElementById("uploadPanel");
const docsContainer=document.getElementById("docsContainer");
const userGreeting=document.getElementById("userGreeting");
const logoutBtn=document.getElementById("logoutBtn");
const cursoSelect=document.getElementById("cursoSelect");
const cursoUpload=document.getElementById("cursoUpload");
const semanaSelect=document.getElementById("semana");
const vistaPanel=document.getElementById("vistaPanel");
const guardarBtn=document.getElementById("guardarBtn");

const cursos=["Arquitectura de Datos","Inglés IV","Gobierno de TI","Machine Learning"];

// POBLAR SELECTS
cursos.forEach(c=>{
  let opt=document.createElement("option");
  opt.value=c; opt.textContent=c; cursoUpload.appendChild(opt);
});
for(let i=1;i<=16;i++){
  let opt=document.createElement("option");
  opt.value="Semana "+i; opt.textContent="Semana "+i; semanaSelect.appendChild(opt);
}

// INDEXEDDB
let db;
const request=indexedDB.open("PortafolioDB",1);
request.onupgradeneeded=function(e){
  db=e.target.result;
  if(!db.objectStoreNames.contains("docs")){
    const store=db.createObjectStore("docs",{ keyPath:"id", autoIncrement:true });
    store.createIndex("curso_semana","curso_semana",{ unique:false });
  }
};
request.onsuccess=function(e){ 
  db=e.target.result; 
  mostrarArchivos();
};
request.onerror=function(e){ alert("Error inicializando IndexedDB"); };

// LOGIN
loginBtn.onclick=()=>modal.style.display="flex";
closeModal.onclick=()=>modal.style.display="none";
doLogin.onclick=()=>{
  let user=document.getElementById("username").value.trim();
  let pass=document.getElementById("password").value.trim();
  if(user==="DAGA" && pass==="74128745"){
    modal.style.display="none";
    localStorage.setItem("logged","DAGA");
    userGreeting.textContent="Bienvenido, "+user;
    uploadPanel.classList.remove("hidden");
    logoutBtn.classList.remove("hidden");
    mostrarArchivos();
  } else alert("Usuario o contraseña incorrectos");
};

// GUARDAR ARCHIVO (hasta 20MB)
guardarBtn.onclick=()=>{
  const file=document.getElementById("fileUpload").files[0];
  if(!file){ alert("Selecciona un archivo"); return; }
  if(file.size > 20*1024*1024){ alert("Archivo demasiado grande. Máx 20MB"); return; }
  const curso=cursoUpload.value;
  const semana=semanaSelect.value;
  const reader=new FileReader();
  reader.onload=function(e){
    const transaction=db.transaction(["docs"],"readwrite");
    const store=transaction.objectStore("docs");
    store.add({
      curso:curso,
      semana:semana,
      curso_semana:[curso,semana],
      name:file.name,
      data:e.target.result
    });
    transaction.oncomplete=()=>{ mostrarArchivos(); };
  };
  reader.readAsDataURL(file);
};

// MOSTRAR ARCHIVOS
function mostrarArchivos(){
  if(!db) return;
  const transaction=db.transaction(["docs"],"readonly");
  const store=transaction.objectStore("docs");
  const req=store.getAll();
  const curso=cursoSelect.value;
  const logged=localStorage.getItem("logged");
  req.onsuccess=function(e){
    const allFiles=e.target.result;
    let gridMap={};
    allFiles.forEach(f=>{
      if(f.curso===curso){
        if(!gridMap[f.semana]) gridMap[f.semana]=[];
        gridMap[f.semana].push(f);
      }
    });
    docsContainer.innerHTML="";
    Object.keys(gridMap).sort((a,b)=>parseInt(a.replace("Semana ",""))-parseInt(b.replace("Semana ",""))).forEach(semana=>{
      let h4=document.createElement("h4"); h4.textContent=semana; docsContainer.appendChild(h4);
      let grid=document.createElement("div"); grid.className="files-grid";
      gridMap[semana].forEach(f=>{
        const ext=f.name.split('.').pop().toLowerCase();
        let preview="";
        if(["png","jpg","jpeg","gif","webp"].includes(ext)) preview=`<img src="${f.data}">`;
        else if(ext==="pdf") preview=`<iframe src="${f.data}"></iframe>`;
        else preview=`<div style="padding:10px;text-align:center;">📄</div>`;
        let div=document.createElement("div");
        div.className="file-item";
        div.innerHTML=`
          <div class="file-preview">${preview}</div>
          <div class="file-name">${f.name}</div>
          <div class="file-actions">
            <a href="${f.data}" target="_blank" class="btn-view" onclick='mostrarVista(${JSON.stringify(f)});return false;'>Ver</a>
            <a href="${f.data}" download="${f.name}" class="btn-download">Descargar</a>
            ${logged==="DAGA"?`<button class="btn-delete" onclick="eliminar(${f.id})">Eliminar</button>`:""}
          </div>
          <div class="overlay">${curso} — ${f.semana}</div>
        `;
        grid.appendChild(div);
      });
      docsContainer.appendChild(grid);
    });
  };
}

// VISTA
function mostrarVista(file){
  let ext=file.name.split('.').pop().toLowerCase();
  let html="";
  if(["png","jpg","jpeg","gif","webp"].includes(ext)) html=`<img src="${file.data}">`;
  else if(ext==="pdf") html=`<iframe src="${file.data}"></iframe>`;
  else html=`<div style="padding:10px;text-align:center;">📄 ${file.name}</div>`;
  vistaPanel.innerHTML=`<button id="closeVista" onclick="cerrarVista()">✖ Cerrar</button>`+html;
  vistaPanel.style.display="flex";
}
function cerrarVista(){ vistaPanel.style.display="none"; vistaPanel.innerHTML=`<button id="closeVista" onclick="cerrarVista()">✖ Cerrar</button>`; }

// ELIMINAR
function eliminar(id){
  const transaction=db.transaction(["docs"],"readwrite");
  const store=transaction.objectStore("docs");
  store.delete(id);
  transaction.oncomplete=()=>{ mostrarArchivos(); };
}

// LOGOUT
function logout(){
  localStorage.removeItem("logged");
  uploadPanel.classList.add("hidden");
  logoutBtn.classList.add("hidden");
  userGreeting.textContent="Bienvenido, invitado";
  cerrarVista();
  mostrarArchivos();
}

// ONLOAD
window.onload=()=>{
  const logged=localStorage.getItem("logged");
  if(logged==="DAGA"){ userGreeting.textContent="Bienvenido, DAGA"; uploadPanel.classList.remove("hidden"); logoutBtn.classList.remove("hidden"); }
  mostrarArchivos();
};
cursoSelect.onchange=mostrarArchivos;
</script>
</body>
</html>





